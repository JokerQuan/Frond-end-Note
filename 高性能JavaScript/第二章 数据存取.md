# 第二章 数据存取

​		有 4 中基本的数据存取位置：字面量、本地变量、数组元素、对象成员。字面量和本地变量的存取速度通常比数组元素、对象成员快。为此有几种模式来优化。

## 管理作用域

​		从确定哪些变量可以访问，到确定 this 的赋值，JavaScript 作用域关系到性能。理解 JavaScript 作用域的工作原理是关键。

### 作用域链和标识符解析

​		每个 JavaScript 都是一个对象，是 Function 对象的一个实例。Function 对象同其他对象一样，拥有可以编程访问的属性，和一系列不能通过代码访问，仅供 JavaScript 引擎存取的内部属性，其中一个就是 [[Scope]]。

​		[[Scope]] 包含了一个函数被创建的作用域中对象的合集（类似于数组）。这个集合被称为函数的作用域链，它决定哪些数据能被函数访问。当一个函数创建后，它的作用域链就会被创建此函数的作用域中可访问的数据对象所填充。

​		作用域链有下面两个时期：

1. 函数创建时，此时函数的作用域链会压入第一个作用域对象，即创建此函数的作用域中可访问的数据对象填充。
2. 函数执行时，会将一个被称为“活动对象”(activation object,AO)的新对象作为第二个作用域对象压入作用域链。活动对象作为函数运行时的变量对象，包含了所有的局部变量、命名参数、参数集合以及 this。此对象在作用域链的最前端。

​        在执行函数的过程中，每遇到一个变量，都会经历一次标识符解析过程以决定从哪里存取数据。该过程搜索执行环境的作用域链，查找同名标识符。搜过过程从作用域链头部开始，即当前运行函数的活动对象。如果找到，就使用；找不到就继续搜索作用域链中的下一个对象。

### 标识符解析的性能

​		标识符所在位置越深，读写速度越慢。但在优化过的 JavaScript 引擎中，可以忽略这个差异。不过一个好的经验是：如果某个跨作用域的值在函数中被引用一次以上，就把它存储到局部变量里。

### 改变作用域链

​		with 块内部会创建一个新的作用域，插入到作用域链的最前面，在活动对象之前。

​		try-catch 的 catch 子句，效果与 with 一样。

### 闭包、作用域和内存

​		闭包自己的活动对象在作用域链的开头，创建闭包的环境、全局对象依次排在后面。



## 对象成员

​		由于 JavaScript 原型、原型链、对象嵌套的原因，读取的对象属性层级越深，性能越差。解决方案和解析标识符类似，多次调用深层的对象属性，先存储到局部变量，再访问就变快了。

​		原型、原型链的相关说明参考高程第六章。