# 第五章 引用类型

## Object类型

- 通过对象字面量定义对象时，不会调用Object构造函数



## Array类型

- 不同版本的ECMAScript使用instanceof判断对象是否为数组有不同方法，ECMAScript 5 中新增了**Array.isArray()** 方法，可以准确判断，但只有较新的浏览器支持，如IE9+等，其他版本判断方法见22.1.1
- sort()方法会把数组项转为字符串，再进行比较，对数字排序时要特别注意
- sort()方法传入比较函数时，比较函数接收两个参数，若第一个需要排在前，返回负数；第二个需要在前，则返回正数，相等则返回0。
- contact()，将当前数组创建一个副本，将传入的参数添加到副本数组的末尾，并返回该副本数组。若传入的不是数组，则直接添加；若传入的是数组，则将数组的每一项加入副本数组。可以传多个参数。
- slice(n,m)方法，取从数组的第n项开始，到第m-1项，组成新数组，并返回，不影响原数组。
- splice(start, count, v1,v2,v3...)方法，可进行删除、插入、替换操作，start是删除开始的位置，count是删除项的数量， v1,v2,v3...是要插入数组的项。该方法返回被删除项所组成的数组，若未删除，则返回空数组。
- indexOf(),lastIndexOf()，从头查找、从尾部开始查找，第二个参数可选，指定查找开始的位置。查找比较时使用全等操作符===。
- 迭代方法，都接收两个参数：要在每一项上运行的函数、运行该函数的作用域对象（可选）：
    - every()，若每一项运行结果都返回true，则返回true
    - some()，若任意一项运行结果返回true，则返回true
    - filter()，返回给定函数运行结果为true的项组成的数组
    - forEach()，遍历，无返回值
    - map()，返回每一项运行的返回值组成的数组
- reduce()，归并方法，接收两个参数：操作函数、基础值（可选）。操作函数接收4个参数：前一个值、当前值、当前索引、数组对象。操作函数的返回值会作为下一次操作的第一个参数。第一次迭代发生在数组的第二项上。reduceRight()，从数组的尾部开始归并。



## Date类型

- Date.parse()，接收表示日期的字符串，返回相应日期的毫秒数，若不能解析，返回NaN
- Date.UTC()，参数依次为年、月（从0开始）、日、时、分、秒、毫秒，年和月为必填，日默认为1，其余默认为0
- ES5新增 Date.now()，取得当前时间的毫秒数，老版本中可用 +new Date()获取。



## RegExp类型

### 创建

#### 字面量形式

```javascript
var exp = / pattern / flags;
```

flags：

- g：全局模式（global），应用于所有字符串，而不是发现第一个匹配项时立即停止。
- i：不区分大小写。
- m：多行模式

#### RegRxp构造函数形式

```javascript
var pattern1 = /[bc]at/i;
var pattern2 = new RegRxp("[bc]at", "i");//与parttern1完全等价
```

**注意**：由于构造函数形式的参数是字符串，所以某些情况下需要进行双重转义

ES3中，字面量形式创建的实例，始终会共享同一个RegRxp实例，所以循环调用会失败，因为上次匹配的索引值没有重置，下次可能就找不到了。

ES5中规定，字面量形式创建的实例，要与构造函数形式一样，每次创建新的实例，避免了上述问题。



### 实例方法

#### exec()

- 接收需要匹配的字符串，返回包含第一个匹配项信息的数组，若无匹配，返回null。

- 返回的数组是Array的实例，但额外包含两个属性：index（匹配项在字符串中的位置）、input（应用正则表达式的字符串）。
- 在返回的数组中，第一项是与整个模式匹配的字符串，其他项是与模式中的捕获组匹配的字符串，若没有捕获组，则该数组只包含一项。

#### exec()与全局标识

- 对于exec()方法而言，即使设置了全局标识g，每次匹配也只返回一个匹配项
- 若未设置全局标识，每次匹配都是返回匹配的第一项
- 若设置了全局标识，则会在剩下的字符串中继续（从lastIndex开始）查找新的匹配项

#### test()

- 传入字符串，匹配则返回true，不匹配返回false

#### toString()、toLocaleString()

- 返回正则表达式的字面量



### 构造函数属性

​		这些属性在其他语言中被看成是静态属性，适用于作用域中的所有正则表达式，且基于所执行的最近一次正则表达式操作而变化，并可用短属性名来访问。

- input，$_，原始字符串
- lastMatch，$&，最近的一次匹配项字符串
- latParen，$+，最近一次的捕获组
- leftContext，$`，input字符串中，lastMatch左边的文本
- rightContext，$'，input字符串中，lastMatch右边的文本
- multiline，$*，是否所有表达式都使用多行模式
- RegExp.$1~$9，存储第一至九个 匹配的捕获组，使用test()方法也会存在这些值



## Function类型

函数实际上是对象，函数名实际是指向函数的指针。

函数没有重载。

### 函数声明与表达式

使用函数声明方式，解析器会进行函数声明提升

```javascript
sum(1,2); //3，可以执行
function sum (n, m) {
    return n + m;
}
```

使用函数表达式的方式，则会报错

```javascript
sum(1,2); //unexpected identifier意外标识错误
var sum = function (n, m) {
    return n + m;
}
```

### 作为值的函数

函数可以作为参数、返回值



### 函数的内部属性

#### arguments

- arguments是一个类数组对象，包含传入函数的所有参数。

- arguments有一个名叫callee的属性，指向拥有这个arguments对象的函数

```javascript
//阶乘
function factorial(num) {
    if (num <= 1) {
        return 1;
    } else {
        //return num * factorial(num - 1);
        return num * arguments.callee(num - 1);
    }
}
```

**利用callee属性，即使以后函数名变了，递归调用也能正确执行，消除了函数名的耦合**

#### this

this指向的是函数执行的环境对象

#### ES 5 中的 caller属性

指向调用当前函数的函数的引用，若在全局作用域中调用当前函数，则caller属性为null。

```javascript
function outer() {
    inner();
}

function inner() {
    console.log(inner.caller);
    //也可以用arguments.callee.caller实现松散的耦合
    console.log(arguments.callee.caller);
}

outer(); // function outer() { inner(); }
```

#### 严格模式

- 访问arguments.callee会导致错误
- 不能为函数的caller属性赋值，否则会导致错误



### 函数属性和方法

- length，表示函数希望接收的命名参数的个数

- prototype，对于所有引用类型而言，这是保存他们所有实例方法的真正所在，见第六章；**prototype不可枚举，无法用for-in发现**。

- 非继承得来的方法，call、apply，用途都是在特定的作用域中调用函数，等于设置函数体内this对象的值。

    - call()，第一个参数指定在其中运行函数的作用域，其余参数都直接传递给函数
    - apply()，两个参数，第一个指定在其中运行函数的作用域，第二个为参数数组，可以是Array的实例，也可以是arguments对象

    以上两个方法，可以**扩充函数赖以运行的作用域，好处是对象不需要与方法有耦合关系**

- ES 5 中，新增 bind()方法，会创建一个函数的实例，其this值会被绑定到传给bind()函数的值

- toString、toLocaleString、valueOf，返回函数的代码，内容因浏览器而异