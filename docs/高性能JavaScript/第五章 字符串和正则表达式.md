---
title: 【高性能 JavaScript】第五章 字符串和正则表达式
date: 2020-02-20
categories:
 - JavaScript
tags:
 - JavaScript
 - 性能
---

## 字符串连接

​		通过循环向字符串尾部不断添加内容时，需要注意性能问题。

### 加（+）和加等（+=）操作符

```javascript
str += "one" + "two";
```

​		上面的代码运行时大概有以下几个步骤：

1. 在内存中创建一个临时字符串。
2. 连接后的字符串 “onetwo” 被赋值给该临时字符串。
3. 临时字符串与 str 当前的值连接。
4. 结果赋值给 str。

​        用以下的代码可以避免产生临时字符串（第一步和第二步），大多数浏览器中能提速 10%~40%：

```javascript
str += "one";
str += "two";
```

​		也可以用一个语句完成：

```javascript
str = str + "one" + "two";
```

​		赋值表达式由 str 开始作为基础，由左向右依次连接，因此避免了使用临时字符串。（注意：必须以 str 为开始）

#### Firefox 和编译期合并

​		在编译期将常量字符串先拼接成一个字符串，减少运行时操作次数，但此技术不太常用，因为通常都是变量字符串进行拼接。

### 数组项合并

​		在 IE 7 中，使用 Array.prototype.join 方法，比 += 操作符的性能好很多。

​		大多数浏览器中，使用 Array.prototype.concat 方法，比 += 操作符慢。



## 正则表达式优化

### 正则表达式工作原理

1. 编译。
2. 设置起始位置。
3. 匹配每个正则表达式字元。当一个特定的字元匹配失败时，正则表达式会尝试**回溯**到之前尝试匹配的位置上，然后尝试其他可能的路径。
4. 匹配成功或失败。



//todo 后面内容涉及正则表达式原理，不常用，暂不深入